<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="css/editProfile.css">
    <link rel="stylesheet" href="css/style.css">
    <title>Settings</title>
    <!-- favicon -->
    <link rel="icon" type="image/x-icon" href="/images/favicon.png">
</head>

<body>

        <!-- header section starts  -->
    
        <header class="header">

            <section class="header-1">
    
                <a href="#" class="logo"> <img src="/images/favicon.png" alt="Lattebook Logo"> LatteBook </a>
    
                <form action="" class="search-form">
                    <input type="search" name="" placeholder="search here..." id="search-box">
                    <label for="search-box" class="fas fa-search"></label>
                </form>
    
                <div class="icons">
                    <div id="search-btn" class="fas fa-search"></div>
                    <a href="/" class="fas fa-heart"></a>
                    <a href="/" class="fas fa-shopping-cart"></a>
                    <a href="/login" class="fas fa-user"></a>
                </div>
    
            </section>

            <!-- bottom navbar for responsive purpose  -->

            <nav class="bottom-navbar">
                <a href="#general" class="fa fa-sliders nav-link active"></a>
                <a href="#profile" class="fas fa-user nav-link"></a>
                <a href="#security" class="fas fa-lock nav-link"></a>
            </nav>
    
        </header>
    
        <!-- header section ends -->

    <div class="container">
        <div class="row main-container">
            <div class="col-md-3 sidebar">
                <div class="sidebar-header">
                    <h2>Settings</h2>
                </div>
                <ul class="nav flex-column">
                    <li class="nav-item"><a href="#general" class="nav-link active">General</a></li>
                    <li class="nav-item"><a href="#profile" class="nav-link">Profile</a></li>
                    <li class="nav-item"><a href="#security" class="nav-link">Security</a></li>
                </ul>
            </div>
        
        <!-- Main Content -->
        <div class = "tab-content col-md-9">

            <!-- General Section -->
            <div class="main-content tab-pane nav-active" id="general">
                <div class="general-header">
                    <h2>General</h2>
                    <p>Manage your general settings</p>
                </div>
                <div class="general-info">
                    <div class="form-group">
                        <label for="language">Language</label>
                        <select class="form-control" id="language">
                            <option>English</option>
                            <option>Vietnamese</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="theme">Theme</label>
                        <select class="form-control" id="theme">
                            <option>Default</option>
                            <option>Dark Mode</option>
                            <option>Light Mode</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="defaultPage">Default Page</label>
                        <select class="form-control" id="defaultPage">
                            <option>Dashboard</option>
                            <option>Search</option>
                            <option>Bookshelf</option>
                        </select>
                    </div>
                </div>
            </div>


            <!-- Profile Section --> 
            
            <div class="main-content tab-pane" id = "profile">
                <div class="profile-header">
                    <h2>Profile</h2>
                    <p>Manage your profile settings</p>
                </div>
                <div class="profile-info row">
                    <div class = "avatar-container col-5">
                        <div class="avatar-upload">
                            <div class="avatar-edit">
                                <input type='file' id="imageUpload" accept=".png, .jpg, .jpeg" />
                                <label for="imageUpload">
                                </label>
                            </div>
                            <div class="avatar-preview">
                                <div id="imagePreview" style="background-image: url('<%= user.profileImage %>');">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-container col-7">
                        <form id="profileForm">
                            <div class="form-group">
                                <label for="fullName">Full Name</label>
                                <input type="text" class="form-control" id="fullName" name="fullName" value="<%= user.fullName %>">
                            </div>
                            <div class="form-group">
                                <label for="email">Email Address</label>
                                <input type="email" class="form-control" id="email" name="email" value="<%= user.email %>">
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone Number</label>
                                <input type="tel" class="form-control" id="phone" name="phone" value="<%= user.phone %>">
                            </div>
                            <div class="form-group">
                                <label for="address">Address</label>
                                <input type="text" class="form-control" id="address" name="address" value="<%= user.address %>">
                            </div>
                            <div class = "button-container">
                                <button type="submit" class="btn">Save Changes</button>
                            </div>
                            
                        </form>
                    </div>

                </div>
            </div>

            <!-- Security Section -->
            <div class="main-content tab-pane" id="security">
                <div class="security-header">
                    <h2>Security</h2>
                    <p>Manage your security settings</p>
                </div>
                <div class="security-info">
                    <div class="form-group">
                        <label for="currentPassword">Current Password</label>
                        <input type="password" class="form-control" id="currentPassword">
                    </div>
                    <div class="form-group">
                        <label for="newPassword">New Password</label>
                        <input type="password" class="form-control" id="newPassword">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm New Password</label>
                        <input type="password" class="form-control" id="confirmPassword">
                    </div>
                    <div class="form-group">
                        <button class="btn" id="savePassword">Save Password</button>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
    </div>

    <section class="footer">
        <div class="credit">&copy; 2024 <span>Latte Book</span> | all rights reserved </div>
    </section>

    <!-- Handling changing profile image -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="js/settings.js"></script>
    <script>
        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    $('#imagePreview').css('background-image', 'url('+e.target.result +')');
                    $('#imagePreview').hide();
                    $('#imagePreview').fadeIn(650);
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
        $("#imageUpload").change(function() {
            readURL(this);

            var formData = new FormData();
            formData.append('profileImage', $('#imageUpload')[0].files[0]);
            formData.append('email', '<%= user.email %>');

            $.ajax({
                url: '/uploadProfileImage',
                type: 'POST',
                data: formData,
                processData: false,  // tell jQuery not to process the data
                contentType: false,  // tell jQuery not to set contentType
                success: function(data) {
                    console.log('Upload successful');
                },
                error: function(error) {
                    console.log('Error:', error);
                }
            });
        });
    </script>

    <!-- Handling changing profile information -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('profileForm').addEventListener('submit', function(e) {
            e.preventDefault();

            var formData = {
                fullName: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value
            };

            fetch('/updateProfile', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData),
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log(data);
                alert(data.message);
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        });
    });
    </script>

    <!-- Handling updating password-->
    <script>
        document.getElementById('savePassword').addEventListener('click', function(e) {
            e.preventDefault();

            var formData = {
                currentPassword: document.getElementById('currentPassword').value,
                newPassword: document.getElementById('newPassword').value,
                confirmPassword: document.getElementById('confirmPassword').value
            };

            fetch('/updatePassword', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData),
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                alert(data.message);
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        });
    </script>
</body>
    
</html>
  